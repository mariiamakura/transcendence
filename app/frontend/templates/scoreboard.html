{% extends "index.html" %}

{% block content %}
  {% if request.user.is_authenticated %}
    <div class="container mt-4">
      <h1 class="text-center">{{ request.user.username }}'s stats</h1>
      <div class="row">
        <div class="col-md-6 offset-md-3">
          <ul class="list-group" id="game-list">
            <p style="padding-top: 1em">Pong:</p>
            <li class="list-group-item">Games played: {{ games_played_pong}}</li>
            <li class="list-group-item">Games won: {{ games_won_pong }}</li>
            <li class="list-group-item">Longest win streak: {{ pong_max_win_streak }}</li>
            <p style="padding-top: 1em">Memory:</p>
            <li class="list-group-item">Games played: {{games_played_memory}}</li>
            <li class="list-group-item">Games won: {{games_won_memory}}</li>
            <li class="list-group-item">Longest win streak: {{memory_max_win_streak}}</li>
            <p style="padding-top: 1em">Historic:</p>
            {% for game in all_games %}
              <li class="list-group-item game-item" style="display: none;">
                {{ game.game_date }} - Game:
                {% if game.pong_game %}
                  Pong
                {% elif game.memory_game %}
                  Memory
                {% endif %}
                - Type:
                {% if game.is_tournament %}
                  Tournament
                {% else %}
                  1vs1
                {% endif %}
                - Players:
                {% for participant in game.participants.all %}
                  {{ participant.display_name }}{% if not forloop.last %} vs {% endif %}
                {% endfor %}
                - Winner: {{ game.winner.display_name }} - Score: {{ game.score_winner }} - {{ game.score_loser }}
              </li>
            {% endfor %}
          </ul>
          <div class="pagination-buttons">
            <button id="prev-page" class="btn btn-primary" style="margin-top: 10px;">Previous</button>
            <button id="next-page" class="btn btn-primary" style="margin-top: 10px;">Next</button>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        console.log("DOM fully loaded and parsed");
        const gameItems = document.querySelectorAll('.game-item');
        let currentPage = 0;
        const itemsPerPage = 5;

        function showPage(page) {
          for (let i = 0; i < gameItems.length; i++) {
            if (i >= page * itemsPerPage && i < (page + 1) * itemsPerPage) {
              gameItems[i].style.display = 'block';
            } else {
              gameItems[i].style.display = 'none';
            }
          }
        }

        document.getElementById('next-page').addEventListener('click', function() {
          if ((currentPage + 1) * itemsPerPage < gameItems.length) {
            currentPage++;
            showPage(currentPage);
          }
        });

        document.getElementById('prev-page').addEventListener('click', function() {
          if (currentPage > 0) {
            currentPage--;
            showPage(currentPage);
          }
        });

        showPage(currentPage);
      });
    </script>
  {% else %}
    <div class="login-prompt">
      <div class="text-center">
        <h2>Welcome!</h2>
        <p>Please sign in or sign up to continue.</p>
        <div class="mt-4">
          <a href="signIn" class="btn btn-primary mr-2">Sign In</a>
          <a href="signUp" class="btn btn-success">Sign Up</a>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}